#!/bin/bash

# check if a current user is a superuser or service user and if not, we try to bump the level

if [ "`whoami`" != "pidgeonsv" ];then
  if [ "$UID" -ne 0 ];then
    if [ -f /usr/bin/sudo ];then
      /usr/bin/sudo su pidgeonsv -c "pidgeon-sv $*"
      exit 0
    fi
    echo "This tool needs to be run either as superuser or as a service user"
    exit 1
  fi
  su pidgeonsv -c "pidgeon-sv $*"
  exit 0
fi

root=/usr/share/pidgeonsv

if [ ! -d "$root" ];then
  echo "Error - the system directory is missing"
  exit 1
fi

if [ ! -f "$root/pidgeon-sv.exe" ];then
  echo "Error - the system binaries are missing"
  exit 1
fi

cd $root || exit 1
mono "$root/pidgeon-sv.exe" $*

exit 0
